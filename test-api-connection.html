<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Connection Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .card {
      background: rgba(255,255,255,0.95);
      color: #333;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    h1 { margin-top: 0; color: #667eea; }
    .status {
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .success { background: #dcfce7; color: #166534; border-left: 4px solid #22c55e; }
    .error { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
    .warning { background: #fef3c7; color: #92400e; border-left: 4px solid #f59e0b; }
    .info { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin-right: 10px;
      margin-top: 10px;
    }
    button:hover { background: #5568d3; }
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
    }
    code { background: #e2e8f0; padding: 2px 6px; border-radius: 4px; color: #1e293b; }
    .icon { font-size: 24px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üîç API Connection Diagnostic Tool</h1>
    <p style="color: #64748b; margin-bottom: 30px;">Ye tool aapke backend connection ko test karega</p>
    
    <div id="results">
      <div class="status info">
        <span class="icon">‚è≥</span>
        <span>Testing shuru ho raha hai...</span>
      </div>
    </div>

    <div style="margin-top: 30px;">
      <button onclick="runAllTests()">üîÑ Re-run Tests</button>
      <button onclick="window.location.reload()">‚Üª Refresh Page</button>
    </div>

    <div style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 8px;">
      <h3 style="margin-top: 0; color: #1e293b;">Console Commands (F12 Console mein type karein):</h3>
      <pre>// 1. Check API URL
window.API.baseUrl()

// 2. Change API URL (agar backend different port pe ho)
window.API.setBaseUrl('http://localhost:5000')

// 3. Direct test
fetch('http://localhost:4000/api/plans')
  .then(r => r.json())
  .then(console.log)
  .catch(console.error)</pre>
    </div>
  </div>

  <script src="api-client.js"></script>
  <script>
    const results = document.getElementById('results');

    async function runAllTests() {
      results.innerHTML = '';
      
      // Test 1: Check if API object exists
      addResult('info', '‚è≥', 'Test 1/5: Checking API object...');
      await sleep(500);
      
      if (typeof window.API === 'undefined') {
        addResult('error', '‚ùå', 'API object nahi mila! api-client.js load nahi hua.');
        return;
      }
      addResult('success', '‚úÖ', `API object mil gaya! Current URL: <code>${window.API.baseUrl()}</code>`);

      // Test 2: Check backend port
      addResult('info', '‚è≥', 'Test 2/5: Backend port check kar rahe hain...');
      await sleep(500);
      
      const expectedUrl = 'http://localhost:4000';
      const currentUrl = window.API.baseUrl();
      
      if (currentUrl === expectedUrl) {
        addResult('success', '‚úÖ', `Port match ho gaya! Backend aur Frontend dono <code>${expectedUrl}</code> pe hain`);
      } else {
        addResult('warning', '‚ö†Ô∏è', `Port mismatch: Frontend expects <code>${currentUrl}</code> but backend is on <code>${expectedUrl}</code>`);
      }

      // Test 3: Test backend health
      addResult('info', '‚è≥', 'Test 3/5: Backend health check...');
      await sleep(500);
      
      try {
        const healthRes = await fetch('http://localhost:4000/api/health');
        if (healthRes.ok) {
          const data = await healthRes.json();
          addResult('success', '‚úÖ', `Backend ONLINE hai! Status: ${data.status}`);
        } else {
          throw new Error(`HTTP ${healthRes.status}`);
        }
      } catch (err) {
        addResult('error', '‚ùå', `Backend offline hai ya respond nahi kar raha! Error: ${err.message}`);
        addResult('warning', 'üí°', 'Solution: Terminal mein jaakar <code>cd backend && npm start</code> run karein');
        return;
      }

      // Test 4: Test CORS
      addResult('info', '‚è≥', 'Test 4/5: CORS check kar rahe hain...');
      await sleep(500);
      
      try {
        const plansRes = await fetch('http://localhost:4000/api/plans', {
          mode: 'cors',
          credentials: 'include'
        });
        
        if (plansRes.ok) {
          addResult('success', '‚úÖ', 'CORS sahi hai! Backend requests accept kar raha hai');
        } else {
          throw new Error(`HTTP ${plansRes.status}`);
        }
      } catch (err) {
        if (err.message.includes('CORS')) {
          addResult('error', '‚ùå', 'CORS error! Backend aapke origin ko allow nahi kar raha');
        } else {
          addResult('error', '‚ùå', `Request failed: ${err.message}`);
        }
      }

      // Test 5: Test Plans API
      addResult('info', '‚è≥', 'Test 5/5: Plans API test...');
      await sleep(500);
      
      try {
        const plans = await window.API.plans();
        if (plans && plans.plans && plans.plans.length > 0) {
          addResult('success', '‚úÖ', `Plans API working! ${plans.plans.length} plans milein:<br><pre>${JSON.stringify(plans.plans, null, 2)}</pre>`);
        } else {
          addResult('warning', '‚ö†Ô∏è', 'Plans API response mila but no plans found');
        }
      } catch (err) {
        addResult('error', '‚ùå', `Plans API failed! Error: ${err.message}`);
      }

      // Final summary
      addResult('info', 'üéâ', '<strong>Tests complete!</strong> Upar ke results check karein aur errors fix karein.');
    }

    function addResult(type, icon, message) {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.innerHTML = `<span class="icon">${icon}</span><span>${message}</span>`;
      results.appendChild(div);
      results.scrollTop = results.scrollHeight;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Auto-run tests on load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(runAllTests, 1000);
    });
  </script>
</body>
</html>
